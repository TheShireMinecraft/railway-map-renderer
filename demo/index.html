<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Railway Map Renderer Demo</title>

		<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
		<script src="../dist/bundle.js"></script>

		<style>
			* {
				margin: 0;
				padding: 0;
			}
		</style>
	</head>
	<body>
		<canvas id="railwayCanvas"></canvas>

		<script type="module">
			const railwayCanvas = document.getElementById("railwayCanvas");
			const railwayMapRenderer = new RailwayMapRenderer(railwayCanvas);

			const stationsData    = (await axios.get("https://shirecraft.us/api/railway/stations"   )).data.data;
			const connectionsData = (await axios.get("https://shirecraft.us/api/railway/connections")).data.data;
			const journeyData     = (await axios.get("https://shirecraft.us/api/railway/route?start=KMG&end=LAC&weighting=time")).data.data.components;

			console.log(journeyData);

			railwayMapRenderer.setData(stationsData,connectionsData);

			railwayMapRenderer.setRoute(journeyData);

			resizeCanvas()

			function resizeCanvas() {
				railwayCanvas.width = window.innerWidth;
				railwayCanvas.height = window.innerHeight;

				railwayMapRenderer.draw();
			}

			window.addEventListener("resize", (ev) => {
				resizeCanvas();
			});

			railwayMapRenderer.onConnectionClicked = (ev) => {
				console.log(`Clicked connection: ${ev.group.name}; ${ev.from_label} ${ev.twoWay ? '<->' : '->'} ${ev.to_label}.`)
			}

			railwayMapRenderer.onStationClicked = (ev) => {
				let groupNames = [];

				ev.groups.forEach(g => {
					groupNames.push(g.name);
				})

				const groupsString = groupNames.length > 0 ? `(${groupNames.join(', ')})` : "(No connections!)";

				console.log(`Clicked station: ${ev.name} ${groupsString}`);
			}
		</script>
	</body>
</html>